# 10 任务：循环引用 + 幽灵依赖（依赖治理入门）

## 背景
我们接手一个仓库，线上偶发报错：
- 有时是 “Cannot find module 'xxx'”（换到 CI/容器就爆）
- 有时是某个变量是 `undefined`（本地偶发、很难复现）

我们需要从“依赖治理”角度定位并修复。

## 当前状态（故意设计的反例）
1. **幽灵依赖**：`src/index.js` 引用了 `lodash`，但本章节的 `package.json` 没有声明它。
2. **循环引用**：`src/a.js` 与 `src/b.js` 相互 `require`，导致其中一个模块拿到对方的“半初始化 exports”，出现 `undefined`。

## 任务清单
### 1. 安装依赖
安装命令与说明请看 `docs/learning.md`。

### 2. 复现幽灵依赖问题
运行 `pnpm run build`，观察并解释报错（为什么是幽灵依赖）。

### 3. 修复幽灵依赖
把缺失的依赖**补充到本章节自己的 `package.json`**（不是依赖“根目录碰巧装过”）。

### 4. 复现循环引用问题
幽灵依赖修好后，再次运行 `pnpm run build`，观察循环引用导致的 `undefined`（或不符合预期的输出）。

### 5. 修复循环引用
要求：消除 `a.js` / `b.js` 的循环依赖。你可以用以下任一方式：
- 提取 `shared.js`（把共同依赖/常量放到第三个模块）
- 依赖倒置（让其中一个模块变成“纯函数”，由上层注入依赖）
- 延迟 require（不推荐作为最终方案，但可作为理解机制的实验）

### 6. 验证
最终 `pnpm run build` 可以稳定运行，并输出正确结果。


